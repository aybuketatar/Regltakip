<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regl TakipÃ§im Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="ana-kapsayici">

        <div id="girisEkrani" class="ekran">
            <header>
                <h1>ğŸŒ¸ HoÅŸ Geldin!</h1>
                <p>Seni daha yakÄ±ndan tanÄ±yalÄ±m.</p>
            </header>

            <div class="form-kutusu">
                <div class="satir">
                    <div class="grup"><label>Ä°sim:</label><input type="text" id="isim" placeholder="AdÄ±n ne?"></div>
                    <div class="grup"><label>YaÅŸ:</label><input type="number" id="yas" placeholder="18"></div>
                </div>
                
                <div class="satir">
                    <div class="grup"><label>Boy (cm):</label><input type="number" id="boy" placeholder="165"></div>
                    <div class="grup"><label>Kilo (kg):</label><input type="number" id="kilo" placeholder="60"></div>
                </div>

                <div class="grup">
                    <label>Herhangi bir ilaÃ§ kullanÄ±yor musun?</label>
                    <select id="ilacDurumu" onchange="ilacKutusuAc()">
                        <option value="hayir">HayÄ±r, kullanmÄ±yorum</option>
                        <option value="evet">Evet, kullanÄ±yorum</option>
                    </select>
                </div>
                
                <div class="grup gizli" id="ilacIsimAlani">
                    <label>Ä°lacÄ±n Ä°smi:</label>
                    <input type="text" id="ilacIsmi" placeholder="Ã–rn: DoÄŸum kontrol hapÄ±...">
                </div>

                <hr>

                <div class="grup">
                    <label>Reglin DÃ¼zenli mi?</label>
                    <select id="duzen">
                        <option value="duzenli">Evet, genelde gÃ¼nÃ¼nde olur</option>
                        <option value="duzensiz">HayÄ±r, bazen ÅŸaÅŸar</option>
                    </select>
                </div>

                <div class="satir">
                    <div class="grup">
                        <label>Son Regl Tarihi:</label>
                        <input type="date" id="sonTarih">
                    </div>
                    <div class="grup">
                        <label>DÃ¶ngÃ¼ SÃ¼resi (GÃ¼n):</label>
                        <input type="number" id="donguSuresi" value="28">
                    </div>
                </div>
                
                <div class="grup">
                    <label>Regl Kanaman KaÃ§ GÃ¼n SÃ¼rÃ¼yor?</label>
                    <input type="number" id="kanamaSuresi" value="5">
                </div>

                <button class="giris-btn" onclick="hesaplaVeGecisYap()">GiriÅŸ Yap ve Hesapla âœ¨</button>
            </div>
        </div>


        <div id="sonucEkrani" class="ekran gizli">
            
            <div class="header-sonuc">
                <h2 id="karsilamaMesaji">Merhaba!</h2>
                <div class="kalan-gun-kutusu">
                    <span id="kalanGunSayisi">0</span>
                    <small>GÃ¼n KaldÄ±</small>
                </div>
                <p id="tahminiTarihYazisi" style="color:#888; font-size:12px; margin-top:5px;"></p>
            </div>

            <div class="grafik-alani">
                <canvas id="reglGrafigi"></canvas>
                <div class="grafik-ortasi">DÃ–NGÃœN</div>
            </div>

            <div class="renk-aciklama">
                <span class="nokta kirmizi"></span> Regl
                <span class="nokta yesil"></span> Yumurtlama
                <span class="nokta mavi"></span> Normal
            </div>

            <div class="bilgi-bolumu">
                <h3>ğŸ’¡ Bilmen Gerekenler</h3>
                
                <button class="akordiyon">Ovulasyon (Yumurtlama) Nedir?</button>
                <div class="panel">
                    <p>YumurtalÄ±klarÄ±ndan birinden olgunlaÅŸmÄ±ÅŸ bir yumurtanÄ±n salÄ±nmasÄ±dÄ±r. Bu dÃ¶nemde hamile kalma ÅŸansÄ± en yÃ¼ksektir. Genelde dÃ¶ngÃ¼nÃ¼n ortasÄ±na denk gelir.</p>
                    

[Image of menstrual cycle diagram]

                </div>

                <button class="akordiyon">Yumurtlama DÃ¶neminde Ne YapmalÄ±yÄ±m?</button>
                <div class="panel">
                    <p>VÃ¼cut Ä±sÄ±n artabilir ve enerjik hissedebilirsin. EÄŸer bebek dÃ¼ÅŸÃ¼nmÃ¼yorsan korunmaya ekstra dikkat etmelisin. EÄŸer bebek dÃ¼ÅŸÃ¼nÃ¼yorsan en uygun zamandÄ±r!</p>
                </div>

                <button class="akordiyon">Regl AÄŸrÄ±sÄ± Ä°Ã§in Ã–neriler</button>
                <div class="panel">
                    <p>SÄ±cak su torbasÄ±, bitki Ã§aylarÄ± (papatya, rezene) ve hafif yÃ¼rÃ¼yÃ¼ÅŸler kramplarÄ± hafifletir. Magnezyum takviyesi de iÅŸe yarayabilir.</p>
                </div>
            </div>

            <div class="yan-oneri" id="yanOneriKutusu">
                <strong>ğŸŒŸ GÃ¼nÃ¼n Ã–nerisi:</strong>
                <p>{{ tavsiye }}</p>
            </div>

            <button onclick="basaDon()" class="cikis-btn">AyarlarÄ± DÃ¼zenle</button>
        </div>

    </div>

    <script>
        // Ä°laÃ§ seÃ§ilirse kutuyu aÃ§
        function ilacKutusuAc() {
            const durum = document.getElementById("ilacDurumu").value;
            const alan = document.getElementById("ilacIsimAlani");
            if (durum === "evet") {
                alan.style.display = "block";
            } else {
                alan.style.display = "none";
            }
        }

        // Akordiyon (AÃ§Ä±lÄ±r Kutu) MantÄ±ÄŸÄ±
        const acc = document.getElementsByClassName("akordiyon");
        for (let i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function() {
                this.classList.toggle("aktif");
                const panel = this.nextElementSibling;
                if (panel.style.maxHeight) {
                    panel.style.maxHeight = null;
                } else {
                    panel.style.maxHeight = panel.scrollHeight + "px";
                } 
            });
        }

        // Hesaplama ve Grafik Ã‡izimi
        let myChart = null; // Grafik deÄŸiÅŸkeni

        function hesaplaVeGecisYap() {
            // Verileri Al
            const isim = document.getElementById("isim").value || "GÃ¼zellik";
            const sonTarihStr = document.getElementById("sonTarih").value;
            const dongu = parseInt(document.getElementById("donguSuresi").value);
            const kanama = parseInt(document.getElementById("kanamaSuresi").value);

            if (!sonTarihStr || !dongu) {
                alert("LÃ¼tfen tarih ve dÃ¶ngÃ¼ sÃ¼resini gir!");
                return;
            }

            // Ekran DeÄŸiÅŸtir
            document.getElementById("girisEkrani").style.display = "none";
            document.getElementById("sonucEkrani").style.display = "block";

            // KarÅŸÄ±lama
            document.getElementById("karsilamaMesaji").innerText = "Merhaba, " + isim + "!";

            // Tarih HesaplarÄ±
            const sonTarih = new Date(sonTarihStr);
            const gelecekTarih = new Date(sonTarih);
            gelecekTarih.setDate(sonTarih.getDate() + dongu);

            const bugun = new Date();
            const farkZaman = gelecekTarih - bugun;
            const farkGun = Math.ceil(farkZaman / (1000 * 60 * 60 * 24));
            
            document.getElementById("kalanGunSayisi").innerText = farkGun > 0 ? farkGun : 0;
            document.getElementById("tahminiTarihYazisi").innerText = "Tahmini Regl: " + gelecekTarih.toLocaleDateString('tr-TR');

            // --- GRAFÄ°K Ã‡Ä°ZÄ°MÄ° (Chart.js) ---
            // DÃ¶ngÃ¼yÃ¼ 3 parÃ§aya bÃ¶leceÄŸiz:
            // 1. Regl (Kanama) -> KÄ±rmÄ±zÄ±
            // 2. FolikÃ¼ler (Normal) -> Mavi
            // 3. Yumurtlama (Fertil) -> YeÅŸil
            // 4. Luteal (Normal) -> Mavi
            
            // Yumurtlama genelde sondan 14. gÃ¼ndÃ¼r. DoÄŸurganlÄ±k penceresi 5 gÃ¼n sÃ¼rer.
            const yumurtlamaGunu = dongu - 14; 
            const normalDonem1 = yumurtlamaGunu - 2 - kanama; // Regl bitiÅŸi ile yumurtlama arasÄ±
            const dogurganDonem = 5; // Yumurtlama civarÄ±
            const normalDonem2 = 14 - 3; // Yumurtlama sonrasÄ±

            const ctx = document.getElementById('reglGrafigi').getContext('2d');
            
            // EÄŸer eski grafik varsa sil (Ã¼st Ã¼ste binmesin)
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'doughnut', // Simit grafik
                data: {
                    labels: ['Regl', 'Normal DÃ¶nem', 'Yumurtlama', 'Normal DÃ¶nem'],
                    datasets: [{
                        data: [kanama, normalDonem1, dogurganDonem, normalDonem2],
                        backgroundColor: [
                            '#ff7675', // KÄ±rmÄ±zÄ± (Regl)
                            '#74b9ff', // Mavi (Normal)
                            '#55efc4', // YeÅŸil (Yumurtlama)
                            '#74b9ff'  // Mavi (Normal)
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '70%', // Ortadaki boÅŸluk
                    plugins: {
                        legend: { display: false }, // Ãœstteki etiketleri gizle
                        tooltip: { enabled: true }
                    }
                }
            });
        }

        function basaDon() {
            document.getElementById("girisEkrani").style.display = "block";
            document.getElementById("sonucEkrani").style.display = "none";
        }
    </script>
</body>
</html>